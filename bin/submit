#!/usr/bin/env bash

# 1. compile code
# 2. upload binary
# 3. upload source

DEST=$CCTF_PATH"/dirs/$USER"

if make
then
	echo "Build succeeded."
	if cp $SRC_NAME $DEST/src && chown cctf $DEST/src/$SRC_NAME
	then
		echo "Uploaded to $DEST/src!"
	else
		echo "Error copying source! to $DEST/src!"
		exit 1
	fi

        if [[ ! -z "${BIN_NAME// }" ]]; then
		if cp $BIN_NAME $DEST/bin && chown cctf $DEST/src/$BIN_NAME
		then
			echo "Uploaded to $DEST/bin!"
		else
			echo "Error copying binary to $DEST/bin!"
			exit 1
		fi
	else
		if cp $SRC_NAME $DEST/bin && chown cctf $DEST/src/$SRC_NAME
		then
			echo "Uploaded to $DEST/bin!"
		else
			echo "Error copying source to $DEST/bin!"
			exit 1
		fi
	fi
else
	echo "Build failed!"
	exit 1
fi
